<script type="text/javascript">
        var apiKey = '<%= API_OPENTOK[:key] %>';
        var sessionId = '<%= @session_id %>';
        var token = '<%= @token %>';
</script>

<script src="/js/webcast.js"></script>
    <br>
    <div class="row">
        <div class="col-md-9 col-sm-9 col-xs-9">

            <div id="subscribers" style="height: 100vh; width: 65%;" ></div>
            <br>
            <div id="publisher"></div>
            <div class="web-buttons row">
                <div class="col-md-4 col-xs-2"></div>    
                <div class="col-md-2 col-xs-3"><button id="mute_audio" type="button" class="btn btn-circle btn-lg white-button"><span class="glyphicon glyphicon-volume-up"></span></button></div>
                <div class="col-md-2 col-xs-3"><button id="end_call" type="button" class="btn btn-danger btn-circle btn-lg "><span class="glyphicon glyphicon-earphone"></span></button></div>
                <div class="col-md-2 col-xs-3"><button id="stop_video" type="button" class="btn btn-circle btn-lg white-button"><span class="glyphicon glyphicon-eye-open"></span></button></div>
            </div>
        </div>
        <div class="col-md-3 col-sm-3 col-xs-12">
        <div class="row">
            <div class="col-md-12 col-sm-12 col-xs-12">

                <div id="textchat">
                <p id="history"></p>
                <form id="textForm">
                <input type="text" placeholder="Input your text here" id="msgTxt"></input>
                </form>
                </div>
            </div>    

            <div class="col-md-12 col-sm-12 col-xs-12">

                <div id="questionChat">
                <p id="questionHistory"></p>
                <form id="questionForm">
                <input type="text" placeholder="Input your question here" id="quesTxt"></input>
                </form>
                </div>
                </div>

        </div>    
    

        </div>      
    </div>  

    <script>
    $("#end_call").click(function() {
        session.disconnect();
        <% flash[:notice] = "Your call has been disconnected"  %>
        window.location.href="/launchpad"
    });


    $("#mute_audio").click(function() {

        $("span", this).toggleClass("glyphicon-volume-off glyphicon-volume-up");
        if($( "#mute_audio span" ).hasClass( "glyphicon-volume-up" )) {
            publisher.publishAudio(true)
        }
        else {
            publisher.publishAudio(false)   
        }
    });

    $("#stop_video").click(function() {

        $("span", this).toggleClass("glyphicon-eye-close glyphicon-eye-open");
        if($( "#stop_video span" ).hasClass( "glyphicon-eye-open" )) {
            publisher.publishVideo(true)
        }
        else {
            publisher.publishVideo(false)   
        }
    });

    var textForm = document.querySelector('#textForm');
    var questionForm = document.querySelector('#questionForm');
    var msgTxt = document.querySelector('#msgTxt');
    var quesTxt = document.querySelector('#quesTxt');

    // Send a signal once the user enters data in the form
    textForm.addEventListener('submit', function(event) {
      event.preventDefault();

      session.signal({
          type: 'msg',
          data: /*'question: ' + */msgTxt.value
        }, function(error) {
          if (!error) {
            msgTxt.value = '';
          }
        });
    });

    questionForm.addEventListener('submit', function(event) {
      event.preventDefault();

      session.signal({
          type: 'ques',
          data: 'question: ' + quesTxt.value
        }, function(error) {
          if (!error) {
            quesTxt.value = '';
          }
        });
    });




 </script>